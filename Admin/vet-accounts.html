<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vet Accounts | VetCare</title>
    <link rel="icon" href="Images/logoonly.png">
    <script src="https://kit.fontawesome.com/84d068d690.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="Styles/reset.css">
    <link rel="stylesheet" href="Styles/main.css">
    <link rel="stylesheet" href="Styles/vet-accounts.css">
</head>

<body>
    <!--Sidenav-->
    <nav id="sideNav" class="sticky">
        <div id="navHead">
            <div class="flex-container-jcenter-acenter">
                <img src="Images/logoonly.png" alt="VetCare Logo">
                <h1>VetCare</h1>
            </div>
            <div id="mobileUserSection" class="flex-container-jcenter-acenter">
                <p id="mobileWelcomeName">Admin</p>
                <button id="mobileProfileSettingsBtn"><i class="fa-solid fa-user fa-fw"></i></button>
                <!-- Profile Settings -->
                <div id="mobileProfileSettingsContainer" style="display: none;">
                    <div id="mobileSettingsItems">
                        <div class="profile-settings-container-row">
                            <p>VetCare Admin</p>
                            <a id="mobileSignOut">Sign Out</a>
                        </div>
                        <div class="profile-settings-container-row">
                            <img src="Images/logoonly.png">
                            <div id="mobileUserDetails">
                                <p id="mobileDisplayName">Admin</p>
                                <p id="mobileUserEmail">Email</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Profile Settings -->
            </div>
        </div>
        <div>
            <ul>
                <li>
                    <a href="index.html">
                        <i class="fa-solid fa-house fa-fw"></i>
                        <p>Home</p>
                    </a>
                </li>
                <li>
                    <a href="appointment-list.html">
                        <i class="fa-solid fa-list fa-fw"></i>
                        <p>Appointment List</p>
                    </a>
                </li>
                <li>
                    <a href="services.html">
                        <i class="fa-solid fa-shield-dog fa-fw"></i>
                        <p>Services</p>
                    </a>
                </li>
                <li>
                    <a href="vet-accounts.html" class="active">
                        <i class="fa-solid fa-user-doctor fa-fw"></i>
                        <p>Vet Accounts</p>
                    </a>
                </li>
                <li>
                    <a href="customer-accounts.html">
                        <i class="fa-solid fa-user fa-fw"></i>
                        <p>Customer Accounts</p>
                    </a>
                </li>
                <li>
                    <a href="reports.html">
                        <i class="fa-regular fa-file-lines fa-fw"></i>
                        <p>Reports</p>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <!--Sidenav-->

    <!--Content-->
    <div id="contentContainer">
        <header>
            <span onclick="toggleNav()">&#9776;</span>
            <div>
                <p id="welcomeName">Admin</p>
                <button id="profileSettingsBtn"><i class="fa-solid fa-user fa-fw"></i></button>
                <!-- Profile Settings -->
                <div id="webProfileSettingsContainer" style="display: none;">
                    <div id="settingsItems">
                        <div class="profile-settings-container-row">
                            <p>VetCare Admin</p>
                            <a id="signOut">Sign Out</a>
                        </div>
                        <div class="profile-settings-container-row">
                            <img src="Images/logoonly.png">
                            <div id="userDetails">
                                <p id="displayName">Admin</p>
                                <p id="userEmail">Email</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Profile Settings -->
            </div>
        </header>
        <main>
            <!--Content goes here-->
            <h1 class="title">Veterinarian Accounts</h1>
            <div id="searchAndAddContainer" class="grid-container">
                <div id="searchContainer">
                    <input id="searchQuery" class="orange-input" type="search" placeholder="Search Vet ID">
                    <button id="searchBtn"><i class="fa fa-search fa-fw"></i></button>
                </div>
                <button type="button" id="showAddForm" class="btn orange-btn">Add Veterinarian Account</button>
            </div>
            <div id="vetAccountsContainer" class="grid-container">
                <!-- Vet account list goes here -->
                <h1>Loading vet accounts...</h1>
            </div>
            <div id="addFormContainer">
                <form id="addForm">
                    <h1 class="title">Add Veterinarian Account</h1>
                    <div id="vetIDContainer">
                        <h1>Vet ID:</h1>
                        <p id="vetID">AHVet20</p>
                    </div>
                    <input type="text" id="email" class="orange-input" placeholder="Email" />
                    <div>
                        <input type="password" id="password" class="orange-input" placeholder="Password" />
                        <input type="password" id="confirmpword" class="orange-input" placeholder="Confirm Password" />
                    </div>
                    <input type="text" id="doctorName" class="orange-input" placeholder="Doctor's Name" />
                    <input type="text" id="doctorPosition" class="orange-input" placeholder="Position" />
                    <div>
                        <div class="flex-container-jspbet-acenter">
                            <label for="status">Status: </label>
                            <select name="status" id="status" class="dropdown-list">
                                <option disabled selected hidden>Status</option>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="flex-container-jspbet-acenter">
                            <label for="is_verified">Verified: </label>
                            <select name="is_verified" id="is_verified" class="dropdown-list">
                                <option disabled selected hidden>Verified</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <button type="button" id="closeForm" class="btn gray-btn">Close</button>
                        <button type="button" id="addInfo" class="btn orange-btn">Add Veterinarian Account</button>
                    </div>
                </form>
            </div>
        </main>
    </div>
    <!--Content-->

    <!--Scripts-->
    <script src="Scripts/sidenavAndProfile.js"></script>
    <script type="module">

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCN94giJdXcm5rxAWL6h9H8Qvjui8vbv8c",
            authDomain: "vetcare-7e474.firebaseapp.com",
            databaseURL: "https://vetcare-7e474-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "vetcare-7e474",
            storageBucket: "vetcare-7e474.appspot.com",
            messagingSenderId: "1073603430864",
            appId: "1:1073603430864:web:7b894986b244cace51d1d5",
            measurementId: "G-T91WHZPKF0"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);
        const getSignOut = document.getElementById("signOut");
        const getMobileSignOut = document.getElementById("mobileSignOut");

        // Removed on auth state changed so it still works without a user logged in.

        // Get vet accounts
        const getVeterinarianAccounts = ref(database, 'veterinarian_account/');
        const getContainer = document.getElementById("vetAccountsContainer");
        onValue(getVeterinarianAccounts, (snapshot) => {
            getContainer.innerHTML = "";
            snapshot.forEach((childSnapshot) => {
                const data = childSnapshot.val();
                var card = "<div class='grid-item'>" +
                    "<div><h1>VetID</h1><p>" + data.vetID + "</p></div>" +
                    "<div><h1>Email</h1><p>" + data.email + "</p></div>" +
                    "<div><h1>Password</h1><p>" + data.password + "</p></div>" +
                    "<div><h1>Doctor Name</h1><p>" + data.doctorName + "</p></div>" +
                    "<div><h1>Doctor Position</h1><p>" + data.doctorPosition + "</p></div>" +
                    "<div><h1>Doctor Name</h1><p>" + data.status + "</p></div></div>";
                getContainer.innerHTML += card;
            })
        })

        // Display add form
        // Count number of rows for generating ID
        showAddForm.addEventListener("click", (e) => {
            var counter = 0;
            onValue(getVeterinarianAccounts, (snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    counter++;
                })
            })
            counter++;
            document.getElementById("vetID").innerHTML = "AHVet" + counter;
            document.getElementById("addFormContainer").style.display = "block";
            document.getElementById("vetAccountsContainer").style.display = "none";
            document.getElementById("showAddForm").style.display = "none";
        });

        // Close add service form
        closeForm.addEventListener("click", (e) => {
            document.getElementById("addFormContainer").style.display = "none";
            document.getElementById("vetAccountsContainer").style.display = "grid";
            document.getElementById("showAddForm").style.display = "block";
        });

        // Save inputted service info to database
        addInfo.addEventListener("click", (e) => {
            if (document.getElementById("password").value == document.getElementById("confirmpword").value) {
                const vetID = document.getElementById("vetID").innerHTML;
                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;
                const doctorName = document.getElementById("doctorName").value;
                const doctorPosition = document.getElementById("doctorPosition").value;
                const status = document.getElementById("status").value;
                const is_verified = document.getElementById("is_verified").value;

                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        // Signed in 
                        const user = userCredential.user;
                        // Update user auth profile
                        onAuthStateChanged(auth, (user) => {
                            if (user) {
                                // Update user auth profile
                                updateProfile(auth.currentUser, {
                                    displayName: doctorName,
                                    email: email
                                }).then(() => {
                                    // Successfully saved to auth
                                }).catch((error) => {
                                    // There was an error in saving to auth
                                });
                            }
                        });

                        // Inserting to database
                        set(ref(database, 'veterinarian_account/' + user.uid), {
                            vetID: vetID,
                            email: email,
                            password: password,
                            doctorName: doctorName,
                            doctorPosition: doctorPosition,
                            status: status,
                            is_verified: is_verified
                        })
                            .then(() => {
                                //Data saved successfully
                                alert("Added vet successfully.");
                                document.getElementById("vetID").innerHTML = "AHVet" + counter;
                                document.getElementById("addForm").reset();
                            })
                            .catch((error) => {
                                //Data saving failed
                                alert("Adding vet has failed.");
                            });
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                    });
            }
            else {
                alert("Passwords do not match. Please try again.");
            }
        })

        // Sign out web user
        getSignOut.addEventListener('click', (e) => {
            console.log("Signing out...");
            signOut(auth).then(() => {
                window.location.href = "../Homepage/account-type.html"
            })
                .catch((error) => {
                    console.log("An error occured while signing out.");
                });
        });

        // Sign out mobile user
        getMobileSignOut.addEventListener('click', (e) => {
            console.log("Signing out...");
            signOut(auth).then(() => {
                window.location.href = "../Homepage/account-type.html"
            })
                .catch((error) => {
                    console.log("An error occured while signing out.");
                });
        });
    </script>
    <!--Scripts-->
</body>

</html>